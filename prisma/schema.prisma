// Pilates Reservation App - Prisma Schema
// Using SQLite for development

generator client {
    provider = "prisma-client"
    output   = "./generated/prisma"
}

datasource db {
    provider = "sqlite"
}

model User {
    id           String        @id @default(cuid())
    name         String
    email        String        @unique
    phone        String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    reservations Reservation[]
    roleId       String?
    role         Role?         @relation(fields: [roleId], references: [id])
}

model Role {
    id          String       @id @default(cuid())
    name        String       @unique
    description String?
    permissions Permission[]
    users       User[]
}

model Permission {
    id          String  @id @default(cuid())
    code        String  @unique // e.g. "money_in.read"
    category    String // e.g. "Money-in"
    description String?
    roles       Role[]
}

model Court {
    id           String        @id @default(cuid())
    name         String        @unique
    description  String?
    createdAt    DateTime      @default(now())
    updatedAt    DateTime      @updatedAt
    reservations Reservation[]
}

model Reservation {
    id        String   @id @default(cuid())
    date      DateTime
    startTime String
    endTime   String
    status    String   @default("PENDING") // PENDING, CONFIRMED, CANCELLED, EXPIRED
    userId    String
    courtId   String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user  User  @relation(fields: [userId], references: [id])
    court Court @relation(fields: [courtId], references: [id])

    @@unique([date, startTime, courtId])
}
